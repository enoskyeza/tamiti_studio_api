# Notifications

This app centralizes notification logic for the project.

---

## Service Function

`dispatch_notification(user, message, **context)` is the single entry point for creating notifications.  
By using a common helper, we can later switch or augment backends without touching callers.

### Extension Points
The service currently only logs messages. Future contributions may:

- **Django Channels** – emit events so connected clients receive real-time updates.
- **Push/Email providers** – forward notifications to external push or email services.

Add logic for these providers inside `dispatch_notification` where TODO markers are placed.

---

## Model Fields

- `id` (UUID)
- `recipient` – ForeignKey to `users.User`
- `actor` – ForeignKey to `users.User` (optional, who triggered the notification)
- `verb` – Short description of the action (e.g., "commented on", "assigned you")
- `target` – GenericForeignKey to related object (optional)
- `url` – Optional URL to view more details
- `is_read` – Boolean flag indicating if the notification has been read
- `created_at` – Timestamp when the notification was created
- `level` – Importance level (`info`, `alert`, `critical`)

---

## Signal Emitters

Notifications can be created in response to signals from other apps:

- **User events** – `post_save` on `users.User` can trigger welcome or profile update notifications.
- **Task lifecycle** – Creation, assignment, or completion of `tasks.Task` instances can emit notifications to assignees and project members.
- **Finance events** – Invoice issued, payment received, or requisition approved can trigger notifications.

---

## API Endpoints

- `GET /api/notifications/` – List notifications for the authenticated user.
- `GET /api/notifications/<id>/` – Retrieve a single notification.
- `POST /api/notifications/<id>/mark-read/` – Mark a notification as read.
- `POST /api/notifications/<id>/mark-unread/` – Mark a notification as unread.
- `POST /api/notifications/mark-all-read/` – Mark all unread notifications as read.

These endpoints allow clients to fetch and manage in-app (and potentially email/push) notifications generated by the system.
